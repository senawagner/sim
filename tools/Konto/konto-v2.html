
<!doctype html>
<html lang="pt-BR">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="robots" content="noindex, nofollow">
      <title>Konto - Meu Controle Financeiro</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
      <!-- jQuery UI CSS -->
      <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
      <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.31.0/dist/umd/supabase.min.js"></script>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
      <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>💰</text></svg>" />
 <style>@media (max-width:768px){.page-item:not(:first-child):not(:last-child){display:none}.pagination .disabled{display:none}}.custom-badge{font-weight:300;font-size:.9em;padding:.35em .6em}.badge-receita{background-color:#28a745;color:#fff;font-weight:300;font-size:.9em;padding:.35em .6em}.badge-despesa{background-color:#dc3545;color:#fff;font-weight:300;font-size:.9em;padding:.35em .6em}.badge-investimento{background-color:#6ec1e4;color:#000;font-weight:300;font-size:.9em;padding:.35em .6em}.chart-container{height:600px;overflow-y:scroll}#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.8);z-index:1050;display:flex;justify-content:center;align-items:center;flex-direction:column}.loader{border:16px solid #f3f3f3;border-radius:50%;border-top:16px solid #3498db;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.text-light{color:#fff}:root{--cor-branco:#fdfdfd;--cor-preto:#222222;--cor-cinza:#828282;--cor-cinza-claro:#f4f4f4;--cor-cinza-escuro:#2f3640;--cor-principal:#4a90e2;--cor-secundaria:#50e3c2;--cor-terciaria:#f5a623;--cor-destaque:#f85f73;--cor-alerta:#d9534f;--cor-sucesso:#34c759;--bg-1:#fefefe;--bg-2:#fafafa;--bg-3:#e8e8e8;--bg-4:#d1d1d1;--navbar-bg:var(--cor-cinza-escuro);--navbar-text-color:var(--cor-branco);--card-bg:var(--cor-branco);--card-header-bg:var(--bg-3);--card-header-color:var(--cor-preto);--input-bg:var(--cor-branco);--input-border-color:var(--bg-4);--footer-bg:var(--bg-2);--footer-text-color:var(--cor-cinza);--placeholder-color:var(--cor-cinza)}#entryFormCard.edit-mode .card-header{background-color:#fff3cd!important;border-color:#fd7e14;color:#000}#entryForm.edit-mode #submitButton{background-color:#fd7e14;border-color:#fd7e14;color:#fff}#entryForm.edit-mode #submitButton:hover{background-color:#e8590c;border-color:#e8590c;color:#fff}#entryForm.edit-mode input.form-control,#entryForm.edit-mode select.form-select,#entryForm.edit-mode textarea.form-control{border-color:#fd7e14}#entryForm.edit-mode input.form-control:focus,#entryForm.edit-mode select.form-select:focus,#entryForm.edit-mode textarea.form-control:focus{border-color:#e8590c;box-shadow:0 0 5px rgb(255 122 56 / .5)}#entryForm input.form-control,#entryForm select.form-select,#entryForm textarea.form-control{border-color:var(--input-border-color)}#entryForm input.form-control:focus,#entryForm select.form-select:focus,#entryForm textarea.form-control:focus{border-color:var(--input-border-color);box-shadow:none}.editar-linha td{background-color:#fff3cd!important;border-color:#fd7e14}70%{box-shadow:0 0 0 15px #fff0}100%{box-shadow:0 0 0 0 #fff0}@media (max-width:576px){.navbar .btn-group{display:none}}body{background-color:var(--bg-1);color:var(--cor-preto);font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}.blurred{filter:blur(5px);color:#fff0;text-shadow:0 0 5px rgb(0 0 0 / .5)}.navbar{background-color:var(--navbar-bg);padding:.5rem 1rem}.navbar-brand,.navbar-text{color:var(--navbar-text-color)}.navbar-brand:hover{color:#adb5bd}.navbar .btn i{color:var(--navbar-text-color)!important}.btn:active,.btn:focus,.btn:focus-visible{outline:0!important;box-shadow:none!important}#toggleTotalVisibility{font-size:1.5rem;color:#555;transition:color .3s ease,transform .3s ease}#toggleTotalVisibility:hover{color:#007bff;transform:scale(1.2)}.modal-content{background-color:var(--bg-2);border-color:var(--bg-3)}.modal-header{background-color:var(--bg-2);color:var(--cor-preto)}.form-control,.form-select{background-color:var(--input-bg);border-color:var(--input-border-color);color:var(--cor-preto)}::placeholder{color:var(--placeholder-color)}.btn-close{color:#fff}.card{background-color:var(--card-bg);border-radius:10px}.card-header{background-color:var(--card-header-bg);color:var(--card-header-color);font-weight:600}.btn-primary{background-color:var(--cor-principal);border-color:var(--cor-principal)}.btn-primary:hover{background-color:var(--cor-terciaria);border-color:var(--cor-terciaria)}.btn-secondary{background-color:var(--cor-secundaria);border-color:var(--cor-secundaria)}.btn-secondary:hover{background-color:var(--cor-destaque);border-color:var(--cor-destaque)}.offcanvas-body{background-color:var(--bg-1);color:var(--cor-preto)}.form-control,.form-select{background-color:var(--input-bg);border-color:var(--input-border-color);color:var(--cor-preto)}.btn-primary{background-color:var(--cor-principal)}.btn-primary:hover{background-color:var(--cor-terciaria)}.nav-tabs .nav-link{color:var(--cor-preto);background-color:#fff0;border:none;font-weight:700}.nav-tabs .nav-link:hover{color:var(--card-header-color);background-color:var(--card-header-bg)}.nav-tabs .nav-link.active{color:var(--navbar-text-color);background:linear-gradient(to bottom,var(--navbar-bg),var(--bg-1));text-shadow:1px 1px 1px var(--cor-preto)}.total-section .bg-success{background:linear-gradient(135deg,#28a745,#218838)!important}.total-section .bg-danger{background:linear-gradient(135deg,#dc3545,#c82333)!important}.total-section .bg-warning{background:linear-gradient(135deg,#ffc107,#e0a800)!important}.total-section .bg-info{background:linear-gradient(135deg,#17a2b8,#138496)!important}.total-section .card-text,.total-section .card-title{color:#fff!important;font-size:1.7em;text-shadow:1px 1px 1px #000;font-weight:900}.total-section .card i{color:#fff!important}.highlighted-categories-scroller{padding:0;position:relative;display:flex;align-items:center;white-space:nowrap;overflow-x:auto;scrollbar-width:none}.highlighted-categories-scroller::-webkit-scrollbar{display:none}.highlighted-categories-scroller:hover{scrollbar-width:thin}.highlighted-categories-scroller:hover::-webkit-scrollbar{height:6px}.highlighted-categories-scroller:hover::-webkit-scrollbar-track{background:#f1f1f1}.highlighted-categories-scroller:hover::-webkit-scrollbar-thumb{background:#888;border-radius:3px}.highlighted-categories-scroller:hover::-webkit-scrollbar-thumb:hover{background:#555}.highlighted-categories-item{display:inline-block;margin-right:15px;text-align:center;min-width:fit-content;background:0 0}.highlighted-categories-item .card-body{border-radius:10px;background:linear-gradient(180deg,rgb(255 255 255 / .3),rgb(0 0 0 / .2));box-shadow:4px 4px 8px rgb(0 0 0 / .1),-4px -4px 8px rgb(255 255 255 / .7);transition:transform .2s,box-shadow .2s}.highlighted-categories-item .card-body:hover{transform:translateY(-2px);box-shadow:6px 6px 12px rgb(0 0 0 / .2),-6px -6px 12px rgb(255 255 255 / .6)}.footer{font-size:75%;padding:1rem;background-color:var(--footer-bg);color:var(--footer-text-color)}.footer a{color:var(--footer-text-color)}.footer a:hover{color:var(--cor-preto)}.table{background-color:var(--card-bg);white-space:nowrap}.table-hover tbody tr:hover{background-color:var(--bg-3)}#filterToggleButton{position:fixed;bottom:20px;left:20px;z-index:1030;border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center;background-color:var(--navbar-bg);color:#fff;box-shadow:0 4px 6px rgb(0 0 0 / .1)}#filterToggleButton:hover{background-color:var(--cor-terciaria);color:#fff}@media (max-width:992px){.filter-section .row>*{flex:1 1 calc(33.33% - 10px);margin-right:5px}.table tbody td,.table thead th{white-space:nowrap}}@media (max-width:576px){.filter-section .form-group{margin-bottom:15px}.filter-section .row>*{flex:1 1 calc(100% - 10px);margin-right:0}}.chart-container{position:relative;margin:auto;width:100%}canvas{max-width:100%;height:auto}.code-block-container{position:relative;background-color:#333;padding:1rem;border-radius:6px;margin-bottom:1rem}.code-block{white-space:pre-wrap;color:#fff;font-family:'Courier New',Courier,monospace}.copy-sql-btn{position:absolute;top:10px;right:10px;background-color:var(--cor-principal);border:none;padding:.5rem 1rem;color:#fff;cursor:pointer;border-radius:4px;font-size:.9rem}.copy-sql-btn:hover{background-color:var(--cor-terciaria)}</style>
   </head>
<body><div id="overlay" style="display:none"><div class="text-light spinner-border" role="status"><span class="visually-hidden">Carregando...</span></div><p class="mt-3 text-light">Gerando arquivo...</div><nav class="navbar navbar-expand-lg"><div class="container"><a href="#" class="navbar-brand" id="topnav"><span id="appNameOrLogo"><i class="fas fa-dolar-sign me-2"></i>Meu Controle Financeiro Simples</span></a><div class="ms-auto navbar-text"><div class="btn-group" role="group"><button class="btn" id="configButton" title="Configurar Supabase"><i class="fas fa-cog"></i></button><button class="btn" id="disconnectButton" title="Desconectar Supabase" style="display:none"><i class="fas fa-plug"></i></button></div></div></div></nav><div class="text-center d-lg-none my-2" id="mobileButtons"><a href="#" class="btn me-2 btn-outline-secondary" id="mobileConfigButton"><i class="fas fa-cog"></i>Configuração</a><a href="#" class="btn btn-outline-danger" id="mobileDisconnectButton"><i class="fas fa-plug"></i>Desconectar</a></div><div class="offcanvas offcanvas-start" id="filtersOffcanvas" aria-labelledby="filtersOffcanvasLabel" tabindex="-1"><div class="offcanvas-header"><h5 class="offcanvas-title" id="filtersOffcanvasLabel">Filtros</h5><button class="btn-close text-reset" type="button" aria-label="Fechar" data-bs-dismiss="offcanvas"></button></div><div class="offcanvas-body"><form id="filtersForm"><div class="mb-3"><label class="form-label" for="filterTipo">Tipo</label><select class="form-select" id="filterTipo"><option value="">Todos<option value="Receita">Receita<option value="Despesa">Despesa<option value="Investimento">Investimento</select></div><div class="mb-3"><label class="form-label" for="filterCategoria">Categoria</label><select class="form-select" id="filterCategoria"><option value="">Todas</select></div><div class="mb-3"><label class="form-label" for="filterAno">Ano</label><select class="form-select" id="filterAno"><option value="">Todos</select></div><div class="mb-3"><label class="form-label" for="filterMes">Mês</label><select class="form-select" id="filterMes"><option value="">Todos</select></div><div class="mb-3"><label class="form-label" for="filterDescricao">Descrição</label><input id="filterDescricao" class="form-control" placeholder="Buscar por descrição"></div><div class="d-flex justify-content-end"><button class="btn btn-primary me-2" id="aplicarFiltros" type="button">Aplicar Filtros</button><button class="btn btn-secondary" id="limparFiltros" type="button">Limpar Filtros</button></div></form></div></div><button class="btn" id="filterToggleButton" aria-controls="filtersOffcanvas" data-bs-target="#filtersOffcanvas" data-bs-toggle="offcanvas" title="Abrir Filtros"><i class="fas fa-filter"></i></button><div class="fade modal" id="configModal" aria-labelledby="configModalLabel" tabindex="-1" aria-hidden="true"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="configModalLabel">Configuração do Supabase</h5><button class="btn-close" type="button" aria-label="Fechar" data-bs-dismiss="modal"></button></div><div class="modal-body"><ul class="nav nav-tabs" id="configModalTabs" role="tablist"><li class="nav-item" role="presentation"><button class="nav-link active" id="instructions-tab" type="button" aria-controls="instructions" aria-selected="true" data-bs-target="#instructions" data-bs-toggle="tab" role="tab">Instruções</button><li class="nav-item" role="presentation"><button class="nav-link" id="form-tab" type="button" aria-controls="form" aria-selected="false" data-bs-target="#form" data-bs-toggle="tab" role="tab">Configuração</button><li class="nav-item" role="presentation"><button class="nav-link" id="personalization-tab" type="button" aria-controls="personalization" aria-selected="false" data-bs-target="#personalization" data-bs-toggle="tab" role="tab">Personalização</button></ul><div class="tab-content" id="configModalTabsContent"><div class="fade tab-pane active show" id="instructions" aria-labelledby="instructions-tab" role="tabpanel"><div class="mt-4"><h6>Como configurar o Supabase:</h6><ol><li>Criar um projeto no Supabase.<li>Executar o seguinte SQL no Supabase:<div class="position-relative code-block-container"><pre class="code-block" id="sqlCodeBlock">
CREATE TABLE IF NOT EXISTS public.setup (
    id serial PRIMARY KEY,              
    app_name_or_logo text NOT NULL,     
    is_logo boolean NOT NULL DEFAULT false,  
    highlighted_categories jsonb DEFAULT '[]'
);

INSERT INTO public.setup (id, app_name_or_logo, is_logo, highlighted_categories)
VALUES (1, 'Konto Controle Financeiro', false, '[]')
ON CONFLICT (id) DO NOTHING;


CREATE TABLE IF NOT EXISTS public.categories (
    id serial PRIMARY KEY,
    categoria text NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS public.entries (
    id serial PRIMARY KEY,
    tipo text NOT NULL,
    data date NOT NULL,
    descricao text NOT NULL,
    valor numeric(12, 2) NOT NULL,
    categoria_id integer REFERENCES public.categories(id) ON DELETE SET NULL
);
</pre><button class="btn btn-primary copy-sql-btn position-absolute" id="copySqlButton">Copiar SQL</button></div><li>Ir em Configurações > API e copiar a Anon Key e a URL do Supabase.<li>Editar o parâmetro "max rows" para 80000.</ol><p></div></div><div class="fade tab-pane" id="form" aria-labelledby="form-tab" role="tabpanel"><div class="mt-4"><form id="supabaseConfigForm"><div class="mb-3"><label class="form-label" for="supabaseUrl">URL do Supabase</label><input id="supabaseUrl" class="form-control" placeholder="https://xxxx.supabase.co" required></div><div class="mb-3"><label class="form-label" for="supabaseAnonKey">Chave Anônima (Anon Key)</label><input id="supabaseAnonKey" class="form-control" placeholder="Sua Chave Anônima" required></div><div class="mb-3"><label class="form-label" for="timezone">Fuso Horário (Timezone)</label><select class="form-select" id="timezone"></select></div><div class="d-grid gap-2"><button class="btn btn-primary" type="submit">Conectar</button></div></form><div class="mt-3" id="configStatus"></div></div></div><div class="fade tab-pane" id="personalization" aria-labelledby="personalization-tab" role="tabpanel"><div class="mt-4"><form id="personalizationForm"><div class="mb-3"><label class="form-label">Personalize o nome do App:</label></div><div class="mb-3"><label class="form-label" id="appInputLabel">Nome do APP</label><input id="appInput" class="form-control" type="text" placeholder="Digite o nome do aplicativo" required><small id="appInputHint" class="form-text text-muted"></small></div><div class="d-grid gap-2"><button class="btn btn-primary" type="submit">Salvar Personalização</button></div></form></div></div></div></div></div></div></div><div class="modal fade" id="affiliateModal" tabindex="-1" aria-labelledby="affiliateModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="affiliateModalLabel">Afilie-se ao Meu App de Controle Financeiro</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body text-center"><img src="https://bit4learn.com/pt/wp-content/uploads/2020/05/Como-criar-uma-conta-no-Hotmart-768x403-1-e1591128127704.jpg" width="300" alt="Afiliação" class="rounded mb-3" style="max-width:100%;height:auto"><p>Está procurando uma forma de ganhar uma renda extra?<br>Torne-se nosso(a) afiliado(a) e ganhe<strong>50% de comissão</strong>em cada venda!</p><p>É simples: afilie-se agora mesmo, divulgue seu link de afiliado e comece a ganhar comissões promovendo nosso aplicativo de controle financeiro.</p><a href="https://app-vlc.hotmart.com/affiliate-recruiting/view/1546A95806976" target="_blank" class="btn btn-success mt-3"><i class="fas fa-share-alt"></i>Clique aqui para se afiliar agora</a><p class="mt-3"><strong>Ganhe 50% de comissão em cada venda!</strong></p></div></div></div></div><div class="modal fade" id="donationModal" tabindex="-1" aria-labelledby="donationModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="donationModalLabel">Apoie este Projeto</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body text-center"><img src="https://coddar.com.br/gravatar/logocoddar.png" alt="Coddar Digital" class="rounded-circle mb-3"><p>Este aplicativo foi criado com carinho para ajudar você a controlar suas finanças de forma simples e eficaz. Se este projeto está te ajudando, considere apoiar para que possamos mantê-lo sempre disponível e atualizado!</p><p><strong>Como apoiar:</strong></p><ul class="list-unstyled"><li><strong>Nome do Titular:</strong> Wagner Sena </li><li><strong>Banco:</strong> Inter</li><li><strong>Chave Pix:</strong><span class="text-primary">34.889.330/0001-00</span></li><li><strong>E-mail de Contato:</strong><a href="mailto:suporte@coddar.com.br">suporte@coddar.com.br</a></li><li><strong>WhatsApp:</strong><a href="https://wa.me/5513991336789" target="_blank">Clique aqui para falar via WhatsApp</a></li></ul><p>Sua contribuição faz toda a diferença! Obrigado por apoiar este projeto 🙏</p></div></div></div></div><div class="container my-5"><ul class="nav nav-tabs" id="myTab" role="tablist"><li class="nav-item" role="presentation"><button class="nav-link active" id="lancamentos-tab" type="button" aria-controls="lancamentos" aria-selected="true" data-bs-target="#lancamentos" data-bs-toggle="tab" role="tab"><i class="fas fa-list"></i> Lançamentos</button><li class="nav-item" role="presentation"><button class="nav-link" id="overview-tab" type="button" aria-controls="overview" aria-selected="false" data-bs-target="#overview" data-bs-toggle="tab" role="tab"><i class="fas fa-chart-pie"></i> Overview</button><li class="nav-item" role="presentation"><button class="nav-link" id="categorias-destacadas-tab" type="button" aria-controls="categorias-destacadas" aria-selected="false" data-bs-target="#categorias-destacadas" data-bs-toggle="tab" role="tab"><i class="fas fa-star"></i> Categorias Destacadas</button></ul><div class="tab-content" id="myTabContent"><div class="fade tab-pane active show" id="lancamentos" aria-labelledby="lancamentos-tab" role="tabpanel"><div class="mt-4 row"><div class="mb-4 col-lg-6"><div class="card" id="entryFormCard"><div class="card-header">Adicionar Lançamento</div><div class="card-body"><form id="entryForm"><input id="entryId" type="hidden"><div class="row g-3"><div class="col-md-6"><label class="form-label" for="tipo">Tipo</label><select class="form-select" id="tipo" required><option value="" disabled="disabled" selected="selected">Selecione<option value="Receita">Receita<option value="Despesa">Despesa<option value="Investimento">Investimento</select></div><div class="col-md-6"><label class="form-label" for="data">Data</label><input id="data" class="form-control" required type="date"></div></div><div class="row g-3 mt-1"><div class="col-md-6"><label class="form-label" for="categoria">Categoria</label><input id="categoria" class="form-control" placeholder="Ex: Salário" required></div><div class="col-md-6"><label class="form-label" for="valor">Valor</label><input id="valor" class="form-control money-mask" placeholder="R$ 0,00" required></div></div><div class="row g-3 mt-3"><div class="col-md-6"><label class="form-label" for="recorrente">Lançamento Recorrente</label><select class="form-select" id="recorrente" required><option value="nao" selected="selected">Nenhum</option><option value="semanal">Semanal</option><option value="mensal">Mensal</option><option value="anual">Anual</option></select></div><div class="col-md-6"><label class="form-label" for="parcelas">Número de Parcelas</label><input type="number" class="form-control" id="parcelas" placeholder="Ex: 12" min="1"></div></div><div class="row g-3 align-items-end mt-1"><div class="col-md-9"><label class="form-label" for="descricao">Descrição</label><textarea class="form-control" id="descricao" placeholder="Ex: Salário de Março" required rows="2"></textarea></div><div class="col-md-3"><button class="btn btn-primary w-100" id="submitButton" type="submit">Adicionar</button></div></div><div class="mt-2" id="formFeedback"></div></form></div></div></div><div class="mb-4 col-lg-6"><div class="total-section"><div class="d-flex align-items-center justify-content-between"><h5 class="mb-3" id="totalizadoresPeriodo">Período Atual</h5><i class="fas fa-eye toggle-visibility" id="toggleTotalVisibility" style="cursor:pointer" title="Mostrar/Ocultar valores"></i></div><div class="row g-3"><div class="col-md-6"><div class="card text-white bg-success"><div class="card-body text-center"><i class="fas icon fa-dollar-sign"></i><h5 class="card-title">Receitas</h5><p class="card-text display-6" id="totalReceitas">R$ 0,00</div></div></div><div class="col-md-6"><div class="card text-white bg-danger"><div class="card-body text-center"><i class="fas icon fa-credit-card"></i><h5 class="card-title">Despesas</h5><p class="card-text display-6" id="totalDespesas">R$ 0,00</div></div></div><div class="col-md-6"><div class="card text-white bg-info"><div class="card-body text-center"><i class="fas icon fa-chart-line"></i><h5 class="card-title">Investimentos</h5><p class="card-text display-6" id="totalInvestimentos">R$ 0,00</div></div></div><div class="col-md-6"><div class="card bg-warning text-dark"><div class="card-body text-center"><i class="fas icon fa-dollar-sign"></i><h5 class="card-title">Saldo</h5><p class="card-text display-6" id="saldoTotal">R$ 0,00</div></div></div></div></div></div></div><div class="container"><div class="row"><div class="col-12 position-relative"><div class="d-flex align-items-center highlighted-categories-scroller" style="overflow-x:auto;white-space:nowrap;height:150px"></div></div></div></div><div class="card mt-4"><div class="card-header">Lançamentos Financeiros</div><div class="card-body"><div class="table-responsive"><table class="table table-hover" id="entriesTable"><thead><tr><th>Data<th>Tipo<th>Categoria<th>Descrição<th>Valor (R$)<th class="text-center align-middle">Ações<tbody></table></div><nav><ul class="justify-content-center pagination" id="pagination"><li class="page-item"><a href="#" class="page-link" id="prevPage">Anterior</a><li class="page-item"><a href="#" class="page-link" id="nextPage">Próximo</a></ul></nav></div></div></div><div class="fade tab-pane" id="overview" aria-labelledby="overview-tab" role="tabpanel"><div class="card mt-4"><div class="card-header">Visão Geral</div><div class="card-body"><div class="row g-3 align-items-end"><div class="col-md-4"><label class="form-label" for="overviewTipo">Tipo</label><select class="form-select" id="overviewTipo"><option value="">Todos<option value="Receita">Receita<option value="Despesa">Despesa<option value="Investimento">Investimento</select></div><div class="col-md-4"><label class="form-label" for="overviewAno">Ano</label><select class="form-select" id="overviewAno"></select></div><div class="col-md-4"><label class="form-label" for="overviewMes">Mês</label><select class="form-select" id="overviewMes"><option value="">Todos</select></div><div class="d-flex justify-content-end col-md-12"><button class="btn btn-primary" id="aplicarFiltrosOverview">Aplicar Filtros</button></div></div><div class="mt-4 row"><div class="mb-4 col-lg-4"><div class="card"><div class="card-header">Receitas, Despesas e Investimentos</div><div class="card-body"><div class="chart-container"><canvas id="graficoReceitasDespesasInvestimentos"></canvas></div></div></div></div><div class="mb-4 col-lg-8"><div class="card"><div class="card-header">Categorias</div><div class="card-body"><div class="chart-container"><canvas id="graficoCategorias"></canvas></div></div></div></div><div class="mb-4 col-12"><div class="card"><div class="card-header">Desempenho Mensal</div><div class="card-body"><div class="chart-container"><canvas id="graficoMensal"></canvas></div></div></div></div></div></div></div></div><div class="fade tab-pane" id="categorias-destacadas" aria-labelledby="categorias-destacadas-tab" role="tabpanel"><div class="card mt-4"><div class="card-header">Configurar Categorias Destacadas</div><div class="card-body"><form id="highlightedCategoriesForm"><div class="mb-3 d-flex justify-content-between"><button class="btn btn-warning" id="generateColorsButton" type="button"><i class="fas me-2 fa-palette"></i>Gerar Cores</button><button class="btn btn-danger" id="ResetColorsButton" type="button"><i class="fas me-2 fa-sync-alt"></i>Redefinir</button><button class="btn btn-primary" id="saveHighlightedCategoriesButton" type="submit"><i class="fas me-2 fa-save"></i>Salvar</button></div><div class="mb-3 mt-4"><div class="row align-items-center"><div class="col-4"><strong>Categorias</strong></div><div class="col-8 text-end"><span class="badge text-bg-info">Fundo</span> <span class="badge text-bg-dark">Fonte</span> <span class="badge text-bg-danger">Delete</span></div></div></div><div class="mb-3 d-flex justify-content-between align-items-center"><label><input type="checkbox" id="selectAllCategories"> Selecionar Todos</label></div><ul class="list-group" id="categoriesList"></ul></form></div></div></div></div></div><footer class="bg-light footer mt-auto py-3"><div class="text-center container"><span class="text-muted">© 2024 - Todos os direitos reservados | <small>Versão 2.0 - 12/10/2024</small> | Desenvolvido por:<a href="https://coddar.com.br"> Coddar Digital </a></span><div class="mt-2"><a href="https://www.coddar.com.br" class="me-3" target="_blank"><i class="fas fa-lg fa-globe"></i></a><a href="https://wa.me/5513991336789?text=Olá Coddar, gostaria de falar com você sobre o app Konto!" class="me-3" target="_blank"><i class="fa-lg fab fa-whatsapp"></i></a></div><div class="mt-2"><a href="#" id="exportExcelButton" class="text-success"><i class="fas fa-lg fa-file-excel"></i> Exportar XLS</a><a href="#" class="ms-3 text-danger" id="dumpSQLButton"><i class="fas fa-lg fa-database"></i> Dump SQL</a><a href="#" id="donationButton" class="ms-3 text-primary"><i class="fas fa-donate"></i> Apoiar</a></div></div></footer>


<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script><script src="https://code.jquery.com/jquery-3.6.0.min.js"></script><script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script><script>$(document).ready(function(){let dKeyPressCount=0;let dKeyTimeout;let entries=[],filteredEntries=[];let currentPage=1,itemsPerPage=50;let currentYear,currentMonth;let graficoMensalChart,graficoReceitasDespesasChart,graficoCategoriasChart;let supabaseClient=null;let isEditing=!1;let lastEditedRowId=null;const configModal=new bootstrap.Modal(document.getElementById("configModal"));const donationModal=new bootstrap.Modal(document.getElementById("donationModal"));const timezone=localStorage.getItem("timezone")||moment.tz.guess();function populateTimezones(){const timezoneSelect=$("#timezone");const timezones=moment.tz.names();timezoneSelect.empty();timezones.forEach((tz)=>{timezoneSelect.append(`<option value="${tz}">${tz}</option>`)});timezoneSelect.val(timezone)}
populateTimezones();document.addEventListener("keydown",function(event){if(event.key.toLowerCase()==="?"){dKeyPressCount++;if(dKeyPressCount===10){downloadOriginalHTML();dKeyPressCount=0;clearTimeout(dKeyTimeout)}
clearTimeout(dKeyTimeout);dKeyTimeout=setTimeout(()=>{dKeyPressCount=0},1000)}});$("#affiliateButton").click(function(){const affiliateModal=new bootstrap.Modal(document.getElementById("affiliateModal"));affiliateModal.show()});function toggleParcelasField(){const recorrente=$("#recorrente").val();if(recorrente==="nao"){$("#parcelas").closest(".col-md-6").hide();$("#parcelas").removeAttr("required");$("#parcelas").val("")}else{$("#parcelas").closest(".col-md-6").show();$("#parcelas").attr("required","required")}}
$("#recorrente").on("change",function(){toggleParcelasField()});toggleParcelasField();$("#selectAllCategories").change(function(){const isChecked=$(this).is(":checked");$("#categoriesList .category-checkbox").prop("checked",isChecked)});$("#categoriesList").on("change",".category-checkbox",function(){const allChecked=$("#categoriesList .category-checkbox").length===$("#categoriesList .category-checkbox:checked").length;$("#selectAllCategories").prop("checked",allChecked)});function downloadOriginalHTML(){const overlay=document.getElementById("overlay");if(overlay){overlay.style.display="flex"}
fetch(window.location.href).then((response)=>response.text()).then((htmlContent)=>{const blob=new Blob([htmlContent],{type:"text/html"});const link=document.createElement("a");link.href=URL.createObjectURL(blob);link.download="pagina_original.html";link.click();setTimeout(()=>{overlay.style.display="none"},1000)}).catch((error)=>{console.error("Erro ao baixar o HTML original:",error);alert("Erro ao baixar o HTML.");overlay.style.display="none"})}
document.getElementById("dumpSQLButton").addEventListener("click",function(){const overlay=document.getElementById("overlay");if(!supabaseClient){alert("Conecte-se ao Supabase primeiro.");return}
if(overlay){overlay.style.display="flex"}
Promise.all([supabaseClient.from("entries").select("*"),supabaseClient.from("categories").select("*"),supabaseClient.from("setup").select("*")]).then(([{data:entries,error:entriesError},{data:categories,error:categoriesError},{data:setup,error:setupError}])=>{if(entriesError||categoriesError||setupError){console.error("Erro ao buscar dados para dump SQL:",entriesError||categoriesError||setupError);alert("Erro ao buscar dados.");overlay.style.display="none";return}
let sqlDump="";sqlDump+="-- Dump da tabela entries\n";sqlDump+="CREATE TABLE IF NOT EXISTS entries (id SERIAL PRIMARY KEY, tipo TEXT, data DATE, descricao TEXT, valor NUMERIC, categoria_id INTEGER);\n";entries.forEach((entry)=>{sqlDump+=`INSERT INTO entries (id, tipo, data, descricao, valor, categoria_id) VALUES (${entry.id}, '${entry.tipo}', '${entry.data}', '${entry.descricao}', ${entry.valor}, ${entry.categoria_id});\n`});sqlDump+="\n-- Dump da tabela categories\n";sqlDump+="CREATE TABLE IF NOT EXISTS categories (id SERIAL PRIMARY KEY, categoria TEXT);\n";categories.forEach((category)=>{sqlDump+=`INSERT INTO categories (id, categoria) VALUES (${category.id}, '${category.categoria}');\n`});sqlDump+="\n-- Dump da tabela setup\n";sqlDump+="CREATE TABLE IF NOT EXISTS setup (id SERIAL PRIMARY KEY, app_name_or_logo TEXT, is_logo BOOLEAN);\n";setup.forEach((s)=>{sqlDump+=`INSERT INTO setup (id, app_name_or_logo, is_logo) VALUES (${s.id}, '${s.app_name_or_logo}', ${s.is_logo});\n`});const blob=new Blob([sqlDump],{type:"text/sql"});const link=document.createElement("a");link.href=URL.createObjectURL(blob);link.download="dump_banco_de_dados.sql";link.click();overlay.style.display="none"}).catch((err)=>{console.error("Erro ao gerar dump SQL:",err);alert("Erro ao gerar o dump SQL.");overlay.style.display="none"})});document.getElementById("exportExcelButton").addEventListener("click",function(){if(!supabaseClient){alert("Conecte-se ao Supabase primeiro.");return}
document.getElementById("overlay").style.display="flex";Promise.all([supabaseClient.from("entries").select("data, tipo, descricao, valor, categories (categoria)").order("data",{ascending:!0}),supabaseClient.from("categories").select("id, categoria"),supabaseClient.from("setup").select("*").eq("id",1),]).then(([{data:entries,error:entriesError},{data:categories,error:categoriesError},{data:setup,error:setupError}])=>{if(entriesError||categoriesError||setupError){console.error("Erro ao buscar dados para exportação:",entriesError||categoriesError||setupError);alert("Erro ao buscar dados.");document.getElementById("overlay").style.display="none";return}
const allEntriesSheet=entries.map((entry)=>({Data:moment(entry.data).format("DD/MM/YYYY"),Tipo:entry.tipo,Categoria:entry.categories.categoria,Descrição:entry.descricao,Valor:entry.valor.toLocaleString("pt-BR",{minimumFractionDigits:2}),}));const receitasSheet=entries.filter((entry)=>entry.tipo==="Receita").map((entry)=>({Data:moment(entry.data).format("DD/MM/YYYY"),Categoria:entry.categories.categoria,Descrição:entry.descricao,Valor:entry.valor.toLocaleString("pt-BR",{minimumFractionDigits:2})}));const despesasSheet=entries.filter((entry)=>entry.tipo==="Despesa").map((entry)=>({Data:moment(entry.data).format("DD/MM/YYYY"),Categoria:entry.categories.categoria,Descrição:entry.descricao,Valor:entry.valor.toLocaleString("pt-BR",{minimumFractionDigits:2})}));const investimentosSheet=entries.filter((entry)=>entry.tipo==="Investimento").map((entry)=>({Data:moment(entry.data).format("DD/MM/YYYY"),Categoria:entry.categories.categoria,Descrição:entry.descricao,Valor:entry.valor.toLocaleString("pt-BR",{minimumFractionDigits:2})}));const categoriesSheet=categories.map((category)=>({ID:category.id,Categoria:category.categoria}));const setupSheet=setup.map((s)=>({ID:s.id,Nome_App_ou_Logo:s.app_name_or_logo,É_Logo:s.is_logo?"Sim":"Não"}));const workbook=XLSX.utils.book_new();XLSX.utils.book_append_sheet(workbook,XLSX.utils.json_to_sheet(allEntriesSheet),"Todos os Lançamentos");XLSX.utils.book_append_sheet(workbook,XLSX.utils.json_to_sheet(receitasSheet),"Receitas");XLSX.utils.book_append_sheet(workbook,XLSX.utils.json_to_sheet(despesasSheet),"Despesas");XLSX.utils.book_append_sheet(workbook,XLSX.utils.json_to_sheet(investimentosSheet),"Investimentos");XLSX.utils.book_append_sheet(workbook,XLSX.utils.json_to_sheet(categoriesSheet),"Categorias");XLSX.utils.book_append_sheet(workbook,XLSX.utils.json_to_sheet(setupSheet),"Setup");XLSX.writeFile(workbook,"lancamentos_financeiros.xlsx");document.getElementById("overlay").style.display="none"}).catch((err)=>{console.error("Erro ao processar os dados:",err);alert("Erro ao gerar o arquivo.");document.getElementById("overlay").style.display="none"})});function resetarCoresEOrdemCategorias(){const listaCategorias=document.querySelectorAll("#categoriesList li");if(listaCategorias.length===0){console.error("Nenhuma categoria encontrada para resetar.");return}
listaCategorias.forEach((categoria,index)=>{const corPadraoFundo="#ffffff";const corPadraoFonte="#000000";const colorPickerBg=categoria.querySelector(".category-bg-color");const colorPickerFont=categoria.querySelector(".category-font-color");if(colorPickerBg&&colorPickerFont){colorPickerBg.value=corPadraoFundo;colorPickerFont.value=corPadraoFonte}
categoria.setAttribute("data-order",index);const checkbox=categoria.querySelector(".category-checkbox");if(checkbox){checkbox.checked=!1}});$("#selectAllCategories").prop("checked",!1);console.log("Cores, ordem e checkboxes resetados com sucesso.")}
document.getElementById("ResetColorsButton").addEventListener("click",resetarCoresEOrdemCategorias);function calcularLuminosidade(rgb){const[r,g,b]=rgb.match(/\d+/g).map(Number);const canais=[r,g,b].map((c)=>{const canal=c/255;return canal<=0.03928?canal/12.92:Math.pow((canal+0.055)/1.055,2.4)});return 0.2126*canais[0]+0.7152*canais[1]+0.0722*canais[2]}
function gerarCorFonte(corDeFundo){const branco="rgb(255, 255, 255)";const preto="rgb(0, 0, 0)";const luminosidadeFundo=calcularLuminosidade(corDeFundo);return luminosidadeFundo<0.5?branco:preto}
function gerarCorAleatoria(){const r=Math.floor(Math.random()*256);const g=Math.floor(Math.random()*256);const b=Math.floor(Math.random()*256);return `rgb(${r}, ${g}, ${b})`}
function gerarCoresAutomaticas(){const listaCategorias=document.querySelectorAll("#categoriesList li");if(listaCategorias.length===0){console.error("Nenhuma categoria encontrada.");return}
listaCategorias.forEach((categoria)=>{const corFundo=gerarCorAleatoria();const corFonte=gerarCorFonte(corFundo);const colorPickerBg=categoria.querySelector(".category-bg-color");const colorPickerFont=categoria.querySelector(".category-font-color");if(colorPickerBg&&colorPickerFont){const corFundoHex=rgbParaHex(corFundo);const corFonteHex=rgbParaHex(corFonte);if(corFundoHex&&corFonteHex){colorPickerBg.value=corFundoHex;colorPickerFont.value=corFonteHex}}else{console.warn("Color pickers não encontrados para uma das categorias.")}})}
function rgbParaHex(rgb){const rgbArray=rgb.match(/\d+/g).map(Number);return"#"+rgbArray.map((x)=>x.toString(16).padStart(2,"0")).join("")}
document.getElementById("generateColorsButton").addEventListener("click",gerarCoresAutomaticas);let highlightedCategoriesSettings=[];let highlightedCategories=[];function renderHighlightedCategoriesScroller(){const scroller=$(".highlighted-categories-scroller");scroller.empty();scroller.append(`
                 <div id="preloader" class="d-flex justify-content-center align-items-center w-100" style="height: 150px;">
                     <div class="spinner-border" role="status">
                         <span class="visually-hidden">Loading...</span>
                     </div>
                 </div>
             `);if(highlightedCategoriesSettings.length===0){scroller.closest(".container").hide();return}
setTimeout(()=>{scroller.empty();let displayEntries=entries.slice();const tipoFiltro=$("#filterTipo").val();const categoriaFiltro=$("#filterCategoria").val();const anoFiltro=$("#filterAno").val();const mesFiltro=$("#filterMes").val();const descricaoFiltro=$("#filterDescricao").val().toLowerCase();if(tipoFiltro)displayEntries=displayEntries.filter((entry)=>entry.tipo===tipoFiltro);if(categoriaFiltro)displayEntries=displayEntries.filter((entry)=>entry.categoria===categoriaFiltro);if(anoFiltro)displayEntries=displayEntries.filter((entry)=>moment(entry.data,"YYYY-MM-DD").year()===parseInt(anoFiltro));if(mesFiltro)displayEntries=displayEntries.filter((entry)=>String(moment(entry.data,"YYYY-MM-DD").month()+1).padStart(2,"0")===mesFiltro);if(descricaoFiltro)displayEntries=displayEntries.filter((entry)=>entry.descricao.toLowerCase().includes(descricaoFiltro));let highlightedTotals=highlightedCategoriesSettings.map((catSetting)=>{const totalValue=displayEntries.filter((entry)=>entry.categoria===catSetting.name).reduce((sum,entry)=>sum+entry.valor,0);return{...catSetting,total:totalValue}});highlightedTotals=highlightedTotals.filter((item)=>item.total!==0);if(highlightedTotals.length===0){scroller.closest(".container").hide();return}else{scroller.closest(".container").show()}
highlightedTotals.forEach((item)=>{const formattedTotal=`R$ ${item.total.toLocaleString("pt-BR", { minimumFractionDigits: 2 })}`;scroller.append(`
                         <div class="highlighted-categories-item">
                             <div class="card text-center" style="background-color: ${item.bgColor}; color: ${item.fontColor};">
                                 <div class="card-body">
                                     <h5 class="card-title font-weight-bold">${item.name}</h5>
                                     <p class="card-text" data-real-value="${formattedTotal}">${formattedTotal}</p>
                                 </div>
                             </div>
                         </div>
                     `)});const isTotalVisible=localStorage.getItem("isTotalVisible")==="true";if(!isTotalVisible){$(".highlighted-categories-scroller .card-text").each(function(){$(this).addClass("blurred").html("*****")})}},1000)}
async function loadHighlightedCategoriesSettings(){if(!supabaseClient)return;try{const{data,error}=await supabaseClient.from("setup").select("highlighted_categories").eq("id",1).single();if(error&&error.code!=="PGRST116"){console.error("Erro ao carregar categorias destacadas:",error.message);return}
if(data&&data.highlighted_categories){highlightedCategoriesSettings=data.highlighted_categories}else{highlightedCategoriesSettings=[]}
renderHighlightedCategoriesScroller()}catch(err){console.error("Erro ao carregar categorias destacadas:",err)}}
$("#scrollLeftButton").click(function(){const scroller=$(".highlighted-categories-scroller");scroller.animate({scrollLeft:scroller.scrollLeft()-200},400)});$("#scrollRightButton").click(function(){const scroller=$(".highlighted-categories-scroller");scroller.animate({scrollLeft:scroller.scrollLeft()+200},400)});function loadCategoriesIntoSettingsTab(){const categoriesList=$("#categoriesList");categoriesList.empty();const highlightedCategoryNames=highlightedCategoriesSettings.map((catSetting)=>catSetting.name);highlightedCategoriesSettings.forEach((catSetting)=>{categoriesList.append(`
                     <li class="list-group-item d-flex align-items-center">
                         <span class="handle me-2" style="cursor: move;"><i class="fas fa-bars"></i></span>
                         <input type="checkbox" class="form-check-input me-2 category-checkbox" checked>
                         <span class="category-name flex-grow-1">${catSetting.name}</span>
                         <input type="color" class="form-control form-control-color me-2 category-bg-color" value="${catSetting.bgColor || "#ffffff"}" title="Cor de Fundo"> &nbsp; 
                         <input type="color" class="form-control form-control-color me-2 category-font-color" value="${catSetting.fontColor || "#000000"}" title="Cor da Fonte">&nbsp;&nbsp;
                         <!-- Botão de deletar com espaçamento -->
                         <button class="btn btn-danger btn-sm delete-category ms-2" type="button">
                             <i class="fas fa-trash-alt"></i>
                         </button>
                     </li>
                 `)});categorias.forEach((categoria)=>{if(!highlightedCategoryNames.includes(categoria)){categoriesList.append(`
                         <li class="list-group-item d-flex align-items-center">
                             <span class="handle me-2" style="cursor: move;"><i class="fas fa-bars"></i></span>
                             <input type="checkbox" class="form-check-input me-2 category-checkbox">
                             <span class="category-name flex-grow-1">${categoria}</span>
                             <input type="color" class="form-control form-control-color me-2 category-bg-color" value="#ffffff" title="Cor de Fundo"> &nbsp; 
                             <input type="color" class="form-control form-control-color me-2 category-font-color" value="#000000" title="Cor da Fonte">&nbsp;&nbsp;
                             <!-- Botão de deletar com espaçamento -->
                             <button class="btn btn-danger btn-sm delete-category ms-2" type="button">
                                 <i class="fas fa-trash-alt"></i>
                             </button>
                         </li>
                     `)}});$("#categoriesList").sortable({handle:".handle"})}
$("#highlightedCategoriesForm").submit(async function(e){e.preventDefault();const newSettings=[];$("#categoriesList li").each(function(index){const checkbox=$(this).find(".category-checkbox");if(checkbox.is(":checked")){const name=$(this).find(".category-name").text();const bgColor=$(this).find(".category-bg-color").val();const fontColor=$(this).find(".category-font-color").val();newSettings.push({name,bgColor,fontColor,order:index})}});try{const{data,error}=await supabaseClient.from("setup").update({highlighted_categories:newSettings}).eq("id",1);if(error){console.error("Erro ao salvar categorias destacadas:",error.message);alert("Erro ao salvar categorias destacadas.");return}
highlightedCategoriesSettings=newSettings;renderHighlightedCategoriesScroller();alert("Categorias destacadas salvas com sucesso!")}catch(err){console.error("Erro ao salvar categorias destacadas:",err);alert("Erro ao salvar categorias destacadas.")}});async function initializeHighlightedCategoriesFeature(){await loadHighlightedCategoriesSettings();loadCategoriesIntoSettingsTab();renderHighlightedCategoriesScroller()}
function entrarModoEdicao(entry){if(entry){$("#recorrente").closest(".row").hide();$("#parcelas").closest(".row").hide();$("#recorrente").removeAttr("required");$("#parcelas").removeAttr("required")}else{$("#recorrente").closest(".row").show();$("#parcelas").closest(".row").show();$("#recorrente").attr("required","required");$("#parcelas").attr("required","required")}}
$("#entriesTable tbody").on("click",".edit-entry",function(){const entryId=$(this).closest("tr").data("id");const entry=entries.find((e)=>e.id===entryId);if(!entry)return;lastEditedRowId=entryId;$("#entriesTable tbody tr").removeClass("editar-linha");const row=$(`#entriesTable tbody tr[data-id="${entryId}"]`);row.addClass("editar-linha");$("#entryId").val(entry.id);$("#tipo").val(entry.tipo);$("#data").val(entry.data);$("#categoria").val(entry.categoria);$("#valor").val(parseFloat(entry.valor).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}));$("#descricao").val(entry.descricao);entrarModoEdicao(!0);$("#submitButton").text("Editar");$("#entryFormCard .card-header").text("Editar Lançamento");$("#entryForm").addClass("edit-mode");$("#entryFormCard").addClass("edit-mode");$("html, body").animate({scrollTop:$("#topnav").offset().top-20},500)});$("#entryForm").off("reset").on("reset",function(){entrarModoEdicao(!1);$("#submitButton").text("Adicionar");$("#entryFormCard .card-header").text("Adicionar Lançamento");$("#entryForm").removeClass("edit-mode");$("#entryFormCard").removeClass("edit-mode")});function editarLancamento(entryId){const entry=entries.find((e)=>e.id===entryId);if(!entry)return;lastEditedRowId=entryId;$("#entriesTable tbody tr").removeClass("editar-linha");const row=$(`#entriesTable tbody tr[data-id="${entryId}"]`);row.addClass("editar-linha");$("#entryId").val(entry.id);$("#tipo").val(entry.tipo);$("#data").val(entry.data);$("#categoria").val(entry.categoria);$("#valor").val(parseFloat(entry.valor).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}));$("#descricao").val(entry.descricao);$("#submitButton").text("Editar");$("#entryFormCard .card-header").text("Editar Lançamento");isEditing=!0;$("#entryForm").addClass("edit-mode");$("#entryFormCard").addClass("edit-mode");$("html, body").animate({scrollTop:$("#topnav").offset().top-20},500)}
const totalizadores=["#totalReceitas","#totalDespesas","#totalInvestimentos","#saldoTotal"];const toggleButton=$("#toggleTotalVisibility");let isTotalVisible=localStorage.getItem("isTotalVisible")==="true";function carregarTotalizadores(){totalizadores.forEach((selector)=>{const totalElement=$(selector);totalElement.html('<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div>')});setTimeout(()=>{if(!isTotalVisible){aplicarBlur()}else{removerBlur()}},1000);$("#totalReceitas").html($("#totalReceitas").data("real-value"));$("#totalDespesas").html($("#totalDespesas").data("real-value"));$("#totalInvestimentos").html($("#totalInvestimentos").data("real-value"));$("#saldoTotal").html($("#saldoTotal").data("real-value"))}
function atualizarTotaisVisuais(){const isTotalVisible=localStorage.getItem("isTotalVisible")==="true";if(isTotalVisible){removerBlur()}else{aplicarBlur()}}
function aplicarBlur(){$("#totalReceitas").addClass("blurred").html("*****");$("#totalDespesas").addClass("blurred").html("*****");$("#totalInvestimentos").addClass("blurred").html("*****");$("#saldoTotal").addClass("blurred").html("*****");$("#toggleTotalVisibility").removeClass("fa-eye").addClass("fa-eye-slash");$(".highlighted-categories-scroller .card-text").each(function(){$(this).addClass("blurred").html("*****")})}
function removerBlur(){$("#totalReceitas").removeClass("blurred").html($("#totalReceitas").data("real-value"));$("#totalDespesas").removeClass("blurred").html($("#totalDespesas").data("real-value"));$("#totalInvestimentos").removeClass("blurred").html($("#totalInvestimentos").data("real-value"));$("#saldoTotal").removeClass("blurred").html($("#saldoTotal").data("real-value"));$("#toggleTotalVisibility").removeClass("fa-eye-slash").addClass("fa-eye");$(".highlighted-categories-scroller .card-text").each(function(){const realValue=$(this).data("real-value");$(this).removeClass("blurred").html(realValue)})}
toggleButton.click(function(){isTotalVisible=!isTotalVisible;localStorage.setItem("isTotalVisible",isTotalVisible);if(isTotalVisible){removerBlur()}else{aplicarBlur()}});carregarTotalizadores();document.getElementById("copySqlButton").addEventListener("click",function(){const sqlCodeBlock=document.getElementById("sqlCodeBlock").innerText;const copyButton=document.getElementById("copySqlButton");if(navigator.clipboard){navigator.clipboard.writeText(sqlCodeBlock).then(function(){alterarTextoBotao("SQL copiado!",copyButton)}).catch(function(err){console.error("Erro ao copiar para a área de transferência:",err);alert("Erro ao copiar para a área de transferência.")})}else{const tempTextArea=document.createElement("textarea");tempTextArea.value=sqlCodeBlock;document.body.appendChild(tempTextArea);tempTextArea.select();try{document.execCommand("copy");alterarTextoBotao("SQL copiado!",copyButton)}catch(err){console.error("Erro ao copiar para a área de transferência:",err);alert("Erro ao copiar para a área de transferência.")}
document.body.removeChild(tempTextArea)}});function alterarTextoBotao(mensagem,botao){const textoOriginal=botao.innerHTML;botao.innerHTML=mensagem;botao.disabled=!0;setTimeout(function(){botao.innerHTML=textoOriginal;botao.disabled=!1},5000)}
document.getElementById("mobileConfigButton").addEventListener("click",function(){configModal.show()});document.getElementById("mobileDisconnectButton").addEventListener("click",function(){if(confirm("Tem certeza de que deseja desconectar do Supabase?")){localStorage.removeItem("supabaseUrl");localStorage.removeItem("supabaseAnonKey");localStorage.removeItem("timezone");supabaseClient=null;alert("Desconectado com sucesso!");location.reload()}});async function carregarPersonalizacao(){try{const{data,error}=await supabaseClient.from("setup").select("app_name_or_logo, is_logo").eq("id",1).single();if(error){console.error("Erro ao carregar personalização:",error.message);return}
if(data){const{app_name_or_logo,is_logo}=data;atualizarCampoAppInput(app_name_or_logo,is_logo);if(is_logo){$("#appLogoOption").prop("checked",!0)}else{$("#appNameOption").prop("checked",!0)}
atualizarNav(app_name_or_logo,is_logo)}}catch(err){console.error("Erro ao carregar personalização do Supabase:",err)}}
function atualizarCampoAppInput(valor,isLogo){const appInput=$("#appInput");const appLabel=$("#appInputLabel");const appInputHint=$("#appInputHint");if(isLogo){appInput.attr("type","url");appInput.attr("placeholder","Digite a URL da imagem do logotipo");appLabel.text("URL do Logotipo");appInputHint.text("Use um logotipo no formato PNG com fundo transparente. Dimensões recomendadas: 50px de altura e até 300px de largura.");appInput.val(valor)}else{appInput.attr("type","text");appInput.attr("placeholder","Digite o nome do aplicativo");appLabel.text("Nome do APP");appInputHint.text("");appInput.val(valor)}}
$("input[name='displayOption']").change(function(){const isLogo=this.value==="logo";atualizarCampoAppInput($("#appInput").val(),isLogo)});$("#personalizationForm").submit(async function(e){e.preventDefault();const isLogo=$("input[name='displayOption']:checked").val()==="logo";const valor=$("#appInput").val();if(!valor){alert("Por favor, preencha o campo.");return}
try{const{error}=await supabaseClient.from("setup").upsert([{id:1,app_name_or_logo:valor,is_logo:isLogo}]);if(error){console.error("Erro ao salvar personalização:",error.message);alert("Erro ao salvar personalização no Supabase.")}else{alert("Personalização salva com sucesso!");atualizarNav(valor,isLogo)}}catch(err){console.error("Erro ao conectar ao Supabase:",err)}});function atualizarNav(valor,isLogo){const appNameOrLogo=$("#appNameOrLogo");if(isLogo){appNameOrLogo.html(`<img src="${valor}" alt="Logotipo do APP" style="height: 50px; max-width: 300px;">`)}else{appNameOrLogo.html(`<i class="fas fa-dollar-sign me-2"></i> ${valor}`)}}
function atualizarNomeOuLogo(valor,isLogo){const appElement=$("#appNameOrLogo");if(isLogo){appElement.html(`<img src="${valor}" alt="Logotipo do APP" style="height: 50px; max-width: 300px;">`)}else{appElement.html(`<i class="fas fas fa-wdollar-sign me-2"></i> ${valor}`)}}
function verificarConexaoSupabase(){const supabaseUrl=localStorage.getItem("supabaseUrl");const supabaseAnonKey=localStorage.getItem("supabaseAnonKey");if(supabaseUrl&&supabaseAnonKey){supabaseClient=supabase.createClient(supabaseUrl,supabaseAnonKey);$("#disconnectButton").show();carregarPersonalizacao();console.log("Conectado ao Supabase")}else{supabaseClient=null;$("#disconnectButton").hide();console.log("Supabase não configurado")}}
verificarConexaoSupabase();$("#disconnectButton").click(function(){if(confirm("Tem certeza de que deseja desconectar do Supabase?")){localStorage.removeItem("supabaseUrl");localStorage.removeItem("supabaseAnonKey");localStorage.removeItem("timezone");supabaseClient=null;alert("Desconectado com sucesso!");location.reload()}});$("#configButton").click(function(){$("#supabaseUrl").val(localStorage.getItem("supabaseUrl")||"");$("#supabaseAnonKey").val(localStorage.getItem("supabaseAnonKey")||"");$("#timezone").val(localStorage.getItem("timezone")||timezone);carregarPersonalizacao();configModal.show()});$("#donationButton").click(function(){donationModal.show()});$("#supabaseConfigForm").submit(async function(e){e.preventDefault();const supabaseUrl=$("#supabaseUrl").val().trim();const supabaseAnonKey=$("#supabaseAnonKey").val().trim();const selectedTimezone=$("#timezone").val();if(!supabaseUrl||!supabaseAnonKey||!selectedTimezone){$("#configStatus").html('<div class="alert alert-danger">Por favor, preencha todos os campos.</div>');return}
supabaseClient=supabase.createClient(supabaseUrl,supabaseAnonKey);const{error}=await supabaseClient.from("categories").select("*").limit(1);if(error){console.error("Erro ao conectar ao Supabase:",error.message);$("#configStatus").html('<div class="alert alert-danger">Erro ao conectar: '+error.message+"</div>");supabaseClient=null}else{$("#configStatus").html('<div class="alert alert-success">Conectado com sucesso!</div>');salvarCredenciaisLocalStorage(supabaseUrl,supabaseAnonKey,selectedTimezone);verificarConexaoSupabase();await carregarCategorias();await carregarEntries();setTimeout(()=>{configModal.hide()},1500)}});function salvarCredenciaisLocalStorage(url,anonKey,timezone){localStorage.setItem("supabaseUrl",url);localStorage.setItem("supabaseAnonKey",anonKey);localStorage.setItem("timezone",timezone)}
async function carregarSetupAutomatico(){const supabaseUrl=localStorage.getItem("supabaseUrl");const supabaseAnonKey=localStorage.getItem("supabaseAnonKey");if(supabaseUrl&&supabaseAnonKey){supabaseClient=supabase.createClient(supabaseUrl,supabaseAnonKey);const{error}=await supabaseClient.from("categories").select("*").limit(1);if(error){console.error("Erro ao conectar com as credenciais do localStorage:",error.message);$("#configStatus").html('<div class="alert alert-danger">Erro ao conectar com as credenciais armazenadas: '+error.message+"</div>");supabaseClient=null;configModal.show()}else{$("#configStatus").html('<div class="alert alert-success">Conectado com sucesso via localStorage!</div>');await carregarCategorias();await carregarEntries()}}else{configModal.show()}}
carregarSetupAutomatico();let categorias=[],categoriaIdMap={};async function carregarCategorias(){if(!supabaseClient)return;const{data,error}=await supabaseClient.from("categories").select("id, categoria, entries(id)").order("categoria",{ascending:!0});if(error){console.error("Erro ao carregar categorias:",error.message);alert("Erro ao carregar categorias: "+error.message);return}
categorias=data.map((item)=>item.categoria);categoriaIdMap={};data.forEach((item)=>{categoriaIdMap[item.categoria]=item.id});$("#categoria").autocomplete({source:categorias,minLength:2});preencherCategoriaFiltro();loadCategoriesIntoSettingsTab()}
function preencherCategoriaFiltro(){const filterCategoria=$("#filterCategoria");filterCategoria.empty().append('<option value="">Todas</option>');categorias.forEach((cat)=>{filterCategoria.append(`<option value="${cat}">${cat}</option>`)})}
async function carregarEntries(){if(!supabaseClient)return;const{data,error}=await supabaseClient.from("entries").select("id, tipo, data, descricao, valor, categoria_id, categories(categoria)").order("data",{ascending:!1}).order("id",{ascending:!1});if(error){console.error("Erro ao carregar lançamentos:",error.message);alert("Erro ao carregar lançamentos: "+error.message);return}
entries=data.map((item)=>({id:item.id,tipo:item.tipo,data:item.data,categoria:item.categories.categoria,descricao:item.descricao,valor:parseFloat(item.valor)}));ordenarLancamentos();const now=moment().tz(timezone);currentYear=now.year();currentMonth=String(now.month()+1).padStart(2,"0");preencherFiltrosAnoMes();$("#filterAno").val(currentYear);$("#filterMes").val(currentMonth);atualizarTabela();$("#overviewTipo").val("");$("#overviewAno").val(currentYear);$("#overviewMes").val(currentMonth);aplicarFiltrosOverview();await initializeHighlightedCategoriesFeature()}
const today=moment().tz(timezone).format("YYYY-MM-DD");$("#data").val(today);$("#valor").on("input",function(){let value=$(this).val().replace(/[^\d]/g,"");if(value===""){$(this).val("");return}
value=(parseInt(value)/100).toFixed(2);$(this).val(parseFloat(value).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}))});function formatDate(dateStr){return moment(dateStr,"YYYY-MM-DD").format("DD/MM/YYYY")}
$("#entryForm").off("submit").on("submit",async function(e){e.preventDefault();if(!supabaseClient){alert("Conecte-se ao Supabase primeiro.");return}
const submitButton=$(this).find('button[type="submit"]');submitButton.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span> Salvando...');const entryId=$("#entryId").val();const tipo=$("#tipo").val();const dataInput=$("#data").val();const categoria=$("#categoria").val();const descricao=$("#descricao").val();const valorStr=$("#valor").val();const valor=parseFloat(valorStr.replace(/[^\d,-]/g,"").replace(",","."));const recorrente=$("#recorrente").val();const parcelas=parseInt($("#parcelas").val())||1;if(isNaN(valor)){alert("Por favor, insira um valor válido.");submitButton.prop("disabled",!1).html(isEditing?"Editar":"Adicionar");return}
let categoria_id=categoriaIdMap[categoria];if(!categoria_id){const{data:newCategory,error:categoryError}=await supabaseClient.from("categories").insert([{categoria}]).select();if(categoryError){console.error("Erro ao adicionar nova categoria:",categoryError.message);$("#formFeedback").html('<div class="alert alert-danger">Erro ao adicionar nova categoria: '+categoryError.message+"</div>");submitButton.prop("disabled",!1).html(isEditing?"Editar":"Adicionar");return}
categoria_id=newCategory[0].id;categorias.push(categoria);categoriaIdMap[categoria]=categoria_id;$("#categoria").autocomplete("option","source",categorias);preencherCategoriaFiltro()}
const dataParaSalvar=dataInput;function calcularNovaData(data,tipoRecorrencia,incremento){const novaData=moment(data);if(tipoRecorrencia==="semanal"){novaData.add(incremento,"weeks")}else if(tipoRecorrencia==="mensal"){novaData.add(incremento,"months")}else if(tipoRecorrencia==="anual"){novaData.add(incremento,"years")}
return novaData.format("YYYY-MM-DD")}
try{let response;if(entryId){response=await supabaseClient.from("entries").update({tipo,data:dataParaSalvar,categoria_id,descricao,valor,}).eq("id",entryId).select();if(response.error){console.error("Erro ao atualizar lançamento:",response.error.message);$("#formFeedback").html('<div class="alert alert-danger">Erro ao atualizar lançamento: '+response.error.message+"</div>");submitButton.prop("disabled",!1).html("Editar");return}
const updatedEntry=response.data[0];const index=entries.findIndex((e)=>e.id===parseInt(entryId));if(index!==-1){entries[index]={id:updatedEntry.id,tipo:updatedEntry.tipo,data:updatedEntry.data,categoria,descricao:updatedEntry.descricao,valor:updatedEntry.valor,}}
$("#formFeedback").html('<div class="alert alert-success">Lançamento atualizado com sucesso!</div>');scrollToEditedRow(entryId)}else{const entriesToInsert=[];for(let i=0;i<parcelas;i++){const novaData=calcularNovaData(dataParaSalvar,recorrente,i);entriesToInsert.push({tipo,data:novaData,categoria_id,descricao:descricao+(parcelas>1?` (parcela ${i + 1}/${parcelas})`:""),valor,})}
response=await supabaseClient.from("entries").insert(entriesToInsert).select();if(response.error){console.error("Erro ao adicionar lançamento:",response.error.message);$("#formFeedback").html('<div class="alert alert-danger">Erro ao adicionar lançamento: '+response.error.message+"</div>");submitButton.prop("disabled",!1).html("Adicionar");return}
response.data.forEach((entry)=>{entries.unshift({id:entry.id,tipo:entry.tipo,data:entry.data,categoria:categoria,descricao:entry.descricao,valor:entry.valor,})});$("#formFeedback").html('<div class="alert alert-success">Lançamento(s) adicionado(s) com sucesso!</div>')}
setTimeout(()=>{$("#formFeedback").html("")},5000);ordenarLancamentos();atualizarTabela();preencherFiltrosAnoMes();aplicarFiltrosOverview();this.reset();$("#data").val(today);$("#submitButton").text("Adicionar");$("#entryFormCard .card-header").text("Adicionar Lançamento");$("#entryForm").removeClass("edit-mode");$(".card").removeClass("edit-mode");isEditing=!1;$("#entryId").val("");await loadCategoriesIntoSettingsTab();await loadHighlightedCategoriesSettings();toggleParcelasField();submitButton.prop("disabled",!1).html("Adicionar")}catch(error){console.error("Erro ao salvar lançamentos:",error);$("#formFeedback").html('<div class="alert alert-danger">Erro ao salvar lançamentos.</div>');submitButton.prop("disabled",!1).html("Adicionar")}});function scrollToEditedRow(entryId){const row=$(`#entriesTable tbody tr[data-id='${entryId}']`);if(row.length>0){$("html, body").animate({scrollTop:row.offset().top-100},500)}else{const index=filteredEntries.findIndex((entry)=>entry.id==entryId);if(index!==-1){currentPage=Math.floor(index/itemsPerPage)+1;atualizarTabela();setTimeout(()=>{scrollToEditedRow(entryId)},100)}else{alert("O lançamento editado não está visível devido aos filtros aplicados.")}}}
async function removerLancamento(entryId){if(!supabaseClient){alert("Conecte-se ao Supabase primeiro.");return}
if(!confirm("Tem certeza de que deseja remover este lançamento?"))return;const{error}=await supabaseClient.from("entries").delete().eq("id",entryId);if(error){console.error("Erro ao remover lançamento:",error.message);alert("Erro ao remover lançamento: "+error.message);return}
entries=entries.filter((entry)=>entry.id!==entryId);ordenarLancamentos();atualizarTabela();preencherFiltrosAnoMes();aplicarFiltrosOverview()}
$("#entriesTable tbody").on("click",".remove-entry",function(){const entryId=$(this).closest("tr").data("id");removerLancamento(entryId)});function preencherFiltrosAnoMes(){const anosUnicos=[...new Set(entries.map((entry)=>moment(entry.data,"YYYY-MM-DD").year()))].sort((a,b)=>b-a);const mesesUnicos=[...new Set(entries.map((entry)=>String(moment(entry.data,"YYYY-MM-DD").month()+1).padStart(2,"0")))].sort();const filterAnoValue=$("#filterAno").val();const filterMesValue=$("#filterMes").val();const overviewAnoValue=$("#overviewAno").val();const overviewMesValue=$("#overviewMes").val();const filterAno=$("#filterAno").empty().append('<option value="">Todos</option>');anosUnicos.forEach((ano)=>{filterAno.append(`<option value="${ano}">${ano}</option>`)});$("#filterAno").val(filterAnoValue);const filterMes=$("#filterMes").empty().append('<option value="">Todos</option>');mesesUnicos.forEach((mes)=>{filterMes.append(`<option value="${mes}">${obterNomeMes(mes)}</option>`)});$("#filterMes").val(filterMesValue);const overviewAno=$("#overviewAno").empty();anosUnicos.forEach((ano)=>{overviewAno.append(`<option value="${ano}">${ano}</option>`)});$("#overviewAno").val(overviewAnoValue);const overviewMes=$("#overviewMes").empty().append('<option value="">Todos</option>');mesesUnicos.forEach((mes)=>{overviewMes.append(`<option value="${mes}">${obterNomeMes(mes)}</option>`)});$("#overviewMes").val(overviewMesValue)}
function obterNomeMes(mesNumero){const meses=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];return meses[parseInt(mesNumero,10)-1]}
function ordenarLancamentos(){entries.sort((a,b)=>new Date(b.data)-new Date(a.data))}
function atualizarTabela(){const tbody=$("#entriesTable tbody");tbody.empty();let displayEntries=entries.slice();const tipoFiltro=$("#filterTipo").val();const categoriaFiltro=$("#filterCategoria").val();const anoFiltro=$("#filterAno").val();const mesFiltro=$("#filterMes").val();const descricaoFiltro=$("#filterDescricao").val().toLowerCase();if(tipoFiltro)displayEntries=displayEntries.filter((entry)=>entry.tipo===tipoFiltro);if(categoriaFiltro)displayEntries=displayEntries.filter((entry)=>entry.categoria===categoriaFiltro);if(anoFiltro)displayEntries=displayEntries.filter((entry)=>moment(entry.data,"YYYY-MM-DD").year()===parseInt(anoFiltro));if(mesFiltro)displayEntries=displayEntries.filter((entry)=>String(moment(entry.data,"YYYY-MM-DD").month()+1).padStart(2,"0")===mesFiltro);if(descricaoFiltro)displayEntries=displayEntries.filter((entry)=>entry.descricao.toLowerCase().includes(descricaoFiltro));filteredEntries=displayEntries;atualizarTotaisFiltrados();const totalPages=Math.ceil(filteredEntries.length/itemsPerPage);if(currentPage>totalPages)currentPage=totalPages>0?totalPages:1;const start=(currentPage-1)*itemsPerPage;const paginatedEntries=filteredEntries.slice(start,start+itemsPerPage);if(paginatedEntries.length===0){tbody.append(`<tr><td colspan="6" class="text-center">Nenhum lançamento encontrado.</td></tr>`)}else{paginatedEntries.forEach((entry)=>{const rowClass=entry.tipo.toLowerCase();const formattedDate=formatDate(entry.data);const badgeClass=entry.tipo==='Receita'?'receita':entry.tipo==='Despesa'?'despesa':'investimento';const row=$(`<tr class="${rowClass}" data-id="${entry.id}">
    <td>${formattedDate}</td>
    <td><span class="badge custom-badge badge-${badgeClass}">${entry.tipo}</span></td>
    <td>${entry.categoria}</td>
    <td>${entry.descricao}</td>
    <td>R$ ${entry.valor.toLocaleString("pt-BR", { minimumFractionDigits: 2 })}</td>
    <td class="text-center align-middle">
        <i class="fas fa-edit text-primary edit-entry me-2" style="cursor: pointer;" title="Editar"></i>
        <i class="fas fa-trash-alt text-danger remove-entry" style="cursor: pointer;" title="Remover"></i>
    </td>
</tr>`);if(entry.id===lastEditedRowId){row.addClass("editar-linha pulse");setTimeout(()=>{row.removeClass("editar-linha pulse")},5000)}
tbody.append(row)})}
atualizarPaginacao()}
function atualizarTotaisFiltrados(){let totalReceitas=0,totalDespesas=0,totalInvestimentos=0;filteredEntries.forEach((entry)=>{if(entry.tipo==="Receita")totalReceitas+=entry.valor;if(entry.tipo==="Despesa")totalDespesas+=entry.valor;if(entry.tipo==="Investimento")totalInvestimentos+=entry.valor});$("#totalReceitas").data("real-value",`R$ ${totalReceitas.toLocaleString("pt-BR", { minimumFractionDigits: 2 })}`);$("#totalDespesas").data("real-value",`R$ ${totalDespesas.toLocaleString("pt-BR", { minimumFractionDigits: 2 })}`);$("#totalInvestimentos").data("real-value",`R$ ${totalInvestimentos.toLocaleString("pt-BR", { minimumFractionDigits: 2 })}`);const saldo=totalReceitas-totalDespesas-totalInvestimentos;$("#saldoTotal").data("real-value",`R$ ${saldo.toLocaleString("pt-BR", { minimumFractionDigits: 2 })}`);atualizarTotaisVisuais();const tipoFiltro=$("#filterTipo").val();const categoriaFiltro=$("#filterCategoria").val();const anoFiltro=$("#filterAno").val();const mesFiltro=$("#filterMes").val();let periodoTexto="Período atual";if(tipoFiltro||categoriaFiltro||anoFiltro||mesFiltro){periodoTexto="Período filtrado";if(mesFiltro&&anoFiltro){periodoTexto+=`: ${obterNomeMes(mesFiltro)}/${anoFiltro}`}else if(anoFiltro){periodoTexto+=`: ${anoFiltro}`}else if(mesFiltro){periodoTexto+=`: ${obterNomeMes(mesFiltro)}`}}
$("#totalizadoresPeriodo").text(periodoTexto)}
$("#aplicarFiltros").click(function(){currentPage=1;atualizarTabela();renderHighlightedCategoriesScroller()});$("#limparFiltros").click(function(){$("#filtersForm")[0].reset();$("#filterAno").val(currentYear);$("#filterMes").val(currentMonth);currentPage=1;atualizarTabela();renderHighlightedCategoriesScroller()});$("#aplicarFiltrosOverview").click(function(){aplicarFiltrosOverview()});function aplicarFiltrosOverview(){const tipo=$("#overviewTipo").val();const anoSelecionado=parseInt($("#overviewAno").val());const mesSelecionado=$("#overviewMes").val();const filtered=entries.filter((entry)=>{const entryDate=moment(entry.data,"YYYY-MM-DD");const entryYear=entryDate.year();const entryMonth=String(entryDate.month()+1).padStart(2,"0");const matchTipo=tipo?entry.tipo===tipo:!0;const matchAno=anoSelecionado?entryYear===anoSelecionado:!0;const matchMes=mesSelecionado?entryMonth===mesSelecionado:!0;return matchTipo&&matchAno&&matchMes});if(filtered.length===0){$("#graficoReceitasDespesasInvestimentos").replaceWith('<p id="graficoReceitasDespesasInvestimentos" class="text-center mt-4">Não há dados para o período selecionado.</p>');$("#graficoCategorias").replaceWith('<p id="graficoCategorias" class="text-center mt-4">Não há dados para o período selecionado.</p>');$("#graficoMensal").replaceWith('<p id="graficoMensal" class="text-center mt-4">Não há dados para o período selecionado.</p>')}else{if($("#graficoReceitasDespesasInvestimentos").prop("tagName")!=="CANVAS"){$("#graficoReceitasDespesasInvestimentos").replaceWith('<canvas id="graficoReceitasDespesasInvestimentos"></canvas>')}
if($("#graficoCategorias").prop("tagName")!=="CANVAS"){$("#graficoCategorias").replaceWith('<canvas id="graficoCategorias"></canvas>')}
if($("#graficoMensal").prop("tagName")!=="CANVAS"){$("#graficoMensal").replaceWith('<canvas id="graficoMensal"></canvas>')}
gerarGraficoReceitasDespesas(filtered);gerarGraficoCategorias(filtered,tipo);gerarGraficoMensal(anoSelecionado,mesSelecionado,filtered)}}
function gerarGraficoReceitasDespesas(filteredEntries){let totalReceitas=0,totalDespesas=0,totalInvestimentos=0;filteredEntries.forEach((entry)=>{if(entry.tipo==="Receita")totalReceitas+=parseFloat(entry.valor);if(entry.tipo==="Despesa")totalDespesas+=parseFloat(entry.valor);if(entry.tipo==="Investimento")totalInvestimentos+=parseFloat(entry.valor);});const ctx1=document.getElementById("graficoReceitasDespesasInvestimentos").getContext("2d");if(graficoReceitasDespesasChart)graficoReceitasDespesasChart.destroy();const totalGeral=totalReceitas+totalDespesas+totalInvestimentos;graficoReceitasDespesasChart=new Chart(ctx1,{type:"doughnut",data:{labels:["Receitas","Despesas","Investimentos"],datasets:[{label:"Total em R$",data:[totalReceitas,totalDespesas,totalInvestimentos],backgroundColor:["#357A38","#C0392B","#6EC1E4"],borderWidth:1,borderColor:"#fff"}],},options:{responsive:!0,plugins:{datalabels:{color:"#fff",formatter:function(value,context){const porcentagem=(value/totalGeral)*100;const arredondado=porcentagem%1>0.51?Math.ceil(porcentagem):Math.floor(porcentagem);return arredondado+"%"},font:{size:12},align:"center",anchor:"center",},tooltip:{callbacks:{label:function(context){const value=context.parsed;const porcentagem=((value/totalGeral)*100).toFixed(2);return `${context.label}: R$ ${value.toLocaleString("pt-BR", { minimumFractionDigits: 2 })} (${porcentagem}%)`},},},legend:{position:"bottom",labels:{boxWidth:20,padding:15}},title:{display:!0,text:"Receitas, Despesas e Investimentos"},},},plugins:[ChartDataLabels],})}
function ajustarBrilho(corRgb,fator){return corRgb.map((canal)=>{let novoValor=canal*fator;return Math.min(255,Math.max(0,Math.round(novoValor)))})}
function gerarCoresGradiente(numeroDeBarras){const coresBase=[[0,123,255],[102,51,153],[255,102,204],[255,165,0],[60,179,113],[255,69,0],[255,215,0],[70,130,180],[255,140,0],[75,0,130],[154,205,50],[199,21,133],];const cores=[];coresBase.forEach((cor)=>{cores.push(`rgb(${cor.join(",")})`);const corEscura=ajustarBrilho(cor,0.5);cores.push(`rgb(${corEscura.join(",")})`)});return cores.slice(0,numeroDeBarras)}
function gerarGraficoCategorias(filteredEntries){const categoriasTotais={};let totalValor=0;filteredEntries.forEach((entry)=>{if(!categoriasTotais[entry.categoria]){categoriasTotais[entry.categoria]=0}
categoriasTotais[entry.categoria]+=parseFloat(entry.valor);totalValor+=parseFloat(entry.valor)});const numCategorias=Object.keys(categoriasTotais).length;const ctx2=document.getElementById("graficoCategorias").getContext("2d");if(graficoCategoriasChart){graficoCategoriasChart.destroy()}
const maxScaleValue=Math.max(...Object.values(categoriasTotais))*1.2;graficoCategoriasChart=new Chart(ctx2,{type:"bar",data:{labels:Object.keys(categoriasTotais),datasets:[{label:"Total em R$",data:Object.values(categoriasTotais),backgroundColor:gerarCoresGradiente(numCategorias),borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{anchor:"end",align:"right",formatter:function(value,context){const porcentagem=(value/totalValor)*100;const arredondado=porcentagem%1>0.51?Math.ceil(porcentagem):Math.floor(porcentagem);return arredondado+"%"},color:"#000",font:{size:10},},tooltip:{callbacks:{label:(context)=>{const valor=context.parsed.x;const porcentagem=(valor/totalValor)*100;const arredondado=porcentagem%1>0.51?Math.ceil(porcentagem):Math.floor(porcentagem);return `${context.label}: R$ ${valor.toLocaleString("pt-BR", { minimumFractionDigits: 2 })} (${arredondado}%)`},},},legend:{display:!1},title:{display:!0,text:"Distribuição por Categoria"},},scales:{y:{ticks:{autoSkip:!1}},x:{beginAtZero:!0,max:maxScaleValue,ticks:{callback:(value)=>"R$ "+value.toLocaleString("pt-BR")},title:{display:!0,text:"Valor (R$)"}}},},plugins:[ChartDataLabels],})}
function gerarCores(num){const baseColors=["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#C9CBCF","#A4A4A4"];return Array.from({length:num},(_,i)=>baseColors[i%baseColors.length])}
function gerarGraficoMensal(anoSelecionado,mesSelecionado,filteredEntriesParam){const receitasPorMes=Array(12).fill(0);const despesasPorMes=Array(12).fill(0);const investimentosPorMes=Array(12).fill(0);filteredEntriesParam.forEach((entry)=>{const entryDate=moment(entry.data,"YYYY-MM-DD");const entryYear=entryDate.year();const entryMonth=entryDate.month();if(anoSelecionado&&entryYear!==anoSelecionado)return;if(mesSelecionado&&String(entryMonth+1).padStart(2,"0")!==mesSelecionado)return;if(entry.tipo==="Receita")receitasPorMes[entryMonth]+=parseFloat(entry.valor);if(entry.tipo==="Despesa")despesasPorMes[entryMonth]+=parseFloat(entry.valor);if(entry.tipo==="Investimento")investimentosPorMes[entryMonth]+=parseFloat(entry.valor);});const ctx3=document.getElementById("graficoMensal").getContext("2d");if(graficoMensalChart)graficoMensalChart.destroy();graficoMensalChart=new Chart(ctx3,{type:"bar",data:{labels:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],datasets:[{label:"Receitas",data:receitasPorMes,backgroundColor:"#357A38"},{label:"Despesas",data:despesasPorMes,backgroundColor:"#C0392B"},{label:"Investimentos",data:investimentosPorMes,backgroundColor:"#6EC1E4"},],},options:{responsive:!0,plugins:{tooltip:{callbacks:{label:(context)=>`${context.dataset.label}: R$ ${context.parsed.y.toLocaleString("pt-BR", { minimumFractionDigits: 2 })}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:(value)=>"R$ "+value.toLocaleString("pt-BR")}}},},})}
function atualizarPaginacao(){const totalPages=Math.ceil(filteredEntries.length/itemsPerPage);const pagination=$("#pagination");pagination.empty();if(totalPages<=1)return;const maxVisiblePages=5;const startPage=Math.max(1,currentPage-Math.floor(maxVisiblePages/2));const endPage=Math.min(totalPages,startPage+maxVisiblePages-1);pagination.append(`<li class="page-item ${currentPage === 1 ? 'disabled' : ''}"><a href="#" class="page-link" id="prevPage">Anterior</a></li>`);if(startPage>1){pagination.append(`<li class="page-item"><a href="#" class="page-link" data-page="1">1</a></li>`);if(startPage>2){pagination.append(`<li class="page-item disabled"><a href="#" class="page-link">...</a></li>`)}}
for(let i=startPage;i<=endPage;i++){pagination.append(`<li class="page-item ${currentPage === i ? 'active' : ''}"><a href="#" class="page-link" data-page="${i}">${i}</a></li>`)}
if(endPage<totalPages){if(endPage<totalPages-1){pagination.append(`<li class="page-item disabled"><a href="#" class="page-link">...</a></li>`)}
pagination.append(`<li class="page-item"><a href="#" class="page-link" data-page="${totalPages}">${totalPages}</a></li>`)}
pagination.append(`<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}"><a href="#" class="page-link" id="nextPage">Próximo</a></li>`);$(".page-link").off("click").on("click",function(e){e.preventDefault();const page=$(this).data("page");if(page){currentPage=page;atualizarTabela()}});$("#prevPage").off("click").on("click",function(e){e.preventDefault();if(currentPage>1){currentPage--;atualizarTabela()}});$("#nextPage").off("click").on("click",function(e){e.preventDefault();if(currentPage<totalPages){currentPage++;atualizarTabela()}})}
$(document).on("click",".delete-category",async function(){const categoriaItem=$(this).closest("li");const categoriaNome=categoriaItem.find(".category-name").text();if(confirm(`Tem certeza de que deseja remover a categoria "${categoriaNome}"?`)){const categoriaId=categoriaIdMap[categoriaNome];const{data:associatedEntries,error}=await supabaseClient.from("entries").select("id").eq("categoria_id",categoriaId);if(error){console.error("Erro ao verificar lançamentos associados à categoria:",error.message);alert("Erro ao verificar lançamentos associados.");return}
if(associatedEntries.length>0){alert(`A categoria "${categoriaNome}" não pode ser removida porque está associada a um ou mais lançamentos.`)}else{const{error:deleteError}=await supabaseClient.from("categories").delete().eq("id",categoriaId);if(deleteError){console.error("Erro ao remover categoria:",deleteError.message);alert("Erro ao remover categoria.")}else{categoriaItem.remove();alert(`A categoria "${categoriaNome}" foi removida com sucesso.`)}}}})});</script>
</body>
</html>
